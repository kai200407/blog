---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

const posts = await getCollection('blog');

// æŒ‰ç³»åˆ—åˆ†ç»„
const seriesMap = new Map<string, { count: number; category: string }>();

posts.forEach(post => {
	const series = post.data.series;
	const category = post.data.category || 'other';
	if (series) {
		const existing = seriesMap.get(series);
		if (existing) {
			existing.count++;
		} else {
			seriesMap.set(series, { count: 1, category });
		}
	}
});

// è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
const seriesList = Array.from(seriesMap.entries())
	.map(([name, data]) => ({ name, ...data }))
	.sort((a, b) => b.count - a.count);

// ç³»åˆ—å›¾æ ‡å’Œé¢œè‰²é…ç½®
const seriesConfig: Record<string, { icon: string; color: string }> = {
	'cpp': { icon: 'âš¡', color: 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' },
	'python': { icon: 'ğŸ', color: 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300' },
	'rabbitmq': { icon: 'ğŸ°', color: 'bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300' },
	'reddit': { icon: 'ğŸ”´', color: 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300' },
	'webrtc': { icon: 'ğŸ“¹', color: 'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300' },
};
---

<Layout title="æŠ€æœ¯ç³»åˆ—" description="æŒ‰ç³»åˆ—æµè§ˆæŠ€æœ¯æ–‡ç« " class="max-w-2xl">
	<section class="py-12">
		<header class="mb-12">
			<p class="text-sm text-muted-foreground mb-4 tracking-wide uppercase">Learning Path</p>
			<h1 class="text-2xl md:text-3xl font-bold tracking-tight mb-4">
				æŠ€æœ¯å­¦ä¹ ç³»åˆ—
			</h1>
			<p class="text-muted-foreground">
				ç³»ç»Ÿæ€§å­¦ä¹ å„ç§æŠ€æœ¯ï¼Œä»å…¥é—¨åˆ°ç²¾é€š
			</p>
		</header>

		<div class="space-y-4">
			{seriesList.map((series) => {
				const config = seriesConfig[series.category] || { icon: 'ğŸ“š', color: 'bg-muted text-muted-foreground' };
				return (
					<a 
						href={`${import.meta.env.BASE_URL}series/${encodeURIComponent(series.name)}`}
						class="block p-6 border border-border hover:border-primary/50 transition-colors group"
					>
						<div class="flex items-center gap-4">
							<span class={`text-2xl p-3 rounded ${config.color}`}>
								{config.icon}
							</span>
							<div class="flex-1">
								<h2 class="text-lg font-medium group-hover:text-primary transition-colors">
									{series.name}
								</h2>
								<p class="text-sm text-muted-foreground mt-1">
									{series.count} ç¯‡æ–‡ç« 
								</p>
							</div>
							<span class="text-muted-foreground group-hover:text-primary transition-colors">
								â†’
							</span>
						</div>
					</a>
				);
			})}
		</div>
	</section>
</Layout>
