---
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';
import Layout from '../../layouts/Layout.astro';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Group posts by year
const postsByYear = posts.reduce((acc, post) => {
	const year = post.data.pubDate.getFullYear();
	if (!acc[year]) acc[year] = [];
	acc[year].push(post);
	return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<Layout title="Writing" description="All posts" class="max-w-2xl">
	<section class="py-12">
		<header class="mb-12">
			<p class="text-sm text-muted-foreground mb-4 tracking-wide uppercase">Archive</p>
			<h1 class="text-2xl md:text-3xl font-bold tracking-tight">
				All Writing
			</h1>
		</header>

		<div class="space-y-12">
			{years.map((year) => (
				<section>
					<h2 class="text-sm text-muted-foreground mb-6 tracking-wide">{year}</h2>
					<ul class="space-y-6">
						{postsByYear[Number(year)].map((post) => (
							<li class="group">
								<a href={`/blog/${post.slug}/`} class="block">
									<article class="flex flex-col sm:flex-row sm:items-baseline gap-1 sm:gap-4">
										<time class="text-sm text-muted-foreground whitespace-nowrap min-w-[80px]">
											<FormattedDate date={post.data.pubDate} />
										</time>
										<h3 class="font-medium group-hover:text-primary transition-colors">
											{post.data.title}
										</h3>
									</article>
								</a>
							</li>
						))}
					</ul>
				</section>
			))}
		</div>
	</section>
</Layout>
