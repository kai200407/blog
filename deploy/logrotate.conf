# =============================================================================
# Nginx 日志轮转配置
# 安装位置: /etc/logrotate.d/nginx-blog
# =============================================================================

/var/log/nginx/blog.access.log
/var/log/nginx/blog.error.log
{
    # 每天轮转
    daily
    
    # 保留 14 天的日志
    rotate 14
    
    # 压缩旧日志
    compress
    
    # 延迟压缩（等下一次轮转时再压缩）
    delaycompress
    
    # 如果日志文件不存在，不报错
    missingok
    
    # 如果日志为空，不轮转
    notifempty
    
    # 创建新日志文件的权限
    create 0640 www-data adm
    
    # 所有日志轮转完成后执行一次
    sharedscripts
    
    # 轮转后重新打开日志文件
    postrotate
        # 发送 USR1 信号让 Nginx 重新打开日志文件
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}
